# 네이버(에프앤가이드) 기업정보 자료 긁어오기

from selenium import webdriver
from bs4 import BeautifulSoup
from time import sleep

def getDataFromTable(table, title):
    td = table.find('td', attrs={'title': title})
    if td is None: return None

    tr = td.find_parent('tr')

    return [
        tr.select_one('.num.ext0').get_text(),
        tr.select_one('.num.ext1').get_text(),
        tr.select_one('.num.ext2').get_text(),
        tr.select_one('.num.ext3').get_text(),
        tr.select_one('.num.ext4').get_text()
    ]


driver = webdriver.Chrome('/Users/dong-guggim/python/selenium/chromedriver')
driver.implicitly_wait(5)

arr_code = ['342550', '192250', '029460', '002380', '344820', '115500', '281820', '089150', '009070', '025880', '093320', '073010', '105330', '272110', '039420', '083550', '032500', '225430', '102370', '381970', '145270', '030200', '053210', '036030', '033780', '064820', '347140', '256940', '024880', '042040', '054410', '258610', '274090', '402420', '217600', '089010', '220260', '052400', '046070', '047770', '078940', '080530', '224060', '417310', '357120', '104540', '027050', '290510', '007810', '190650', '101670', '123410', '003690', '036690', '049430', '183300', '041960', '089890', '009730', '189350', '082660', '192820', '044820', '222040', '241710', '005070', '005420', '069110', '169670', '071950', '166480', '045970', '196450', '029960', '002020', '003070', '102940', '120110', '950160', '138490', '056000', '021240', '033290', '056360', '282880', '121850', '015710', '052330', '322780', '126600', '036420', '200130', '031820', '294570', '192400', '284740', '317690', '365270', '060280', '015590', '040350', '051780', '115180', '182360', '066310', '136660', '016600', '264900', '005740', '259960', '096240', '215570', '043590', '114120', '110790', '900250', '083790', '045520', '036170', '214150', '352770', '237880', '139670', '020120', '413600', '039490', '054780', '336040', '219130', '318660', '180060', '065130', '134580', '014580', '015890', '006890', '023160', '003240', '011280', '053620', '004100', '116100', '009410', '044490', '124560', '001420', '007980', '191420', '073640', '182690', '066700', '095610', '131970', '055490', '308700', '089030', '258050', '054450', '091440', '078000', '200230', '214420', '393210', '215480', '051360', '045340', '108230', '079970', '199800', '105550', '290090', '026150', '322180', '117730', '033830', '084870', '057680', '064760', '246710', '340570', '043220', '277880', '131290', '019180', '356860', '062860', '363280', '321550', '091810', '004870', '069260', '104480', '309900', '081150', '130740', '217880', '084730', '046210', '058530', '034230', '033540', '043200', '214450', '217950', '208340', '005690', '177830', '037070', '150900', '037030', '047310', '266870', '368770', '170790', '049120', '038950', '106240', '131760', '065690', '140860', '091700', '202960', '032800', '318010', '036580', '027710', '004720', '225590', '054300', '068050', '028670', '222110', '010820', '016800', '263750', '251970', '001020', '327610', '087010', '090080', '010770', '119500', '389140', '022100', '058430', '009520', '047050', '003670', '189690', '318020', '256630', '331380', '234100', '041020', '114630', '290720', '005670', '094940', '007330', '017810', '093380', '023900', '103140', '005810', '371950', '370090', '220100', '035200', '334970', '950210', '203690', '321260', '303360', '053610', '377220', '335810', '053160', '041590', '367000', '075130', '222670', '009810', '237820', '023770', '300080', '150440', '032580', '051380', '241820', '237750', '024850', '319660', '031980', '002230', '057880', '043370', '242350', '239890', '347740', '137400', '128660', '006140', '376180', '304840', '062970', '087600', '161580', '347770', '163730', '332710', '341160', '343510', '363260', '388220', '400560', '406760', '086790', '299030', '067310', '372290', '166090', '293480', '039130', '136480', '003380', '149980', '013030', '352820', '126700', '106080', '071090', '340120', '377400', '400840', '221840', '106190', '019490', '000080', '000140', '373200', '066130', '152550', '004590', '036460', '039340', '005430', '071050', '034950', '010040', '025540', '222980', '331660', '256840', '004090', '025550', '002200', '002960', '017890', '000240', '080720', '123890', '015760', '063570', '041460', '006200', '101680', '039740', '053300', '025770', '409570', '009540', '023350', '025890', '000970', '104700', '017960', '023760', '054040', '050540', '161890', '024720', '021650', '161390', '053590', '034830', '007280', '032300', '168490', '037230', '010100', '047810', '123690', '003350', '030520', '052600', '011500', '002390', '256150', '014790', '092460', '060980', '053690', '042700', '008930', '128940', '047080', '009240', '020000', '003680', '105630', '069640', '016450', '009180', '070590', '213500', '014680', '004710', '010420', '004150', '025750', '226440', '042520', '004960', '011700', '078350', '045100', '001750', '018880', '009420', '014130', '046110', '024740', '005860', '300720', '123840', '002220', '006390', '003300', '007770', '051600', '052690', '130660', '107640', '002320', '003480', '180640', '005110', '043090', '079170', '009460', '086960', '372910', '054920', '002680', '000880', '088350', '000370', '009830', '272210', '012450', '003530', '386580', '195870', '034810', '076610', '059270', '101530', '220180', '143210', '900270', '084990', '000720', '267270', '170030', '005440', '086280', '042670', '064350', '079430', '012330', '319400', '010620', '048410', '052260', '069960', '004560', '016790', '004310', '322000', '041440', '039010', '017800', '307950', '011210', '090850', '267260', '005380', '004020', '329180', '001500', '011760', '227840', '126560', '001450', '057050', '092300', '138360', '011080', '093240', '003010', '111110', '008770', '060560', '064240', '039610', '002460', '378850', '241590', '006060', '013520', '010690', '126640', '133820', '061250', '010660', '000850', '016580', '032560', '004800', '094280', '097870', '298040', '298050', '298020', '298000', '093370', '081660', '290270', '005870', '353190', '090710', '205470', '115160', '028080', '032860', '200670', '212310', '079980', '065510', '215090', '005010', '263920', '243070', '084110', '145020', '024060', '010240', '189980', '000540', '003280', '037440', '238490']
f = open('output.txt', 'w')
for stock_code in arr_code :
    print('\n[' + stock_code + ']')
    driver.get('https://navercomp.wisereport.co.kr/v2/company/c1040001.aspx?cmp_cd=' + stock_code)
    sleep(2);

    html = driver.page_source
    soup = BeautifulSoup(html, 'html.parser')

    table = soup.select('table.gHead01.data-list')

    arr_per = getDataFromTable(table[3], 'PER')
    print(arr_per)
    arr_pbr = getDataFromTable(table[3], 'PBR')
    print(arr_pbr)
    arr_pcr = getDataFromTable(table[3], 'PCR')
    print(arr_pcr)
    arr_psr = getDataFromTable(table[3], 'PSR')
    print(arr_psr)

    # 종목들 목록을 돌면서 크롤링

    # 텍스트 파일에 저장하기
    f.writelines(['\n', '[' + stock_code + ']', '\n'])
    f.writelines([', '.join(arr_per), '\n'] if arr_per is not None else 'None\n')
    f.writelines([', '.join(arr_pbr), '\n'] if arr_pbr is not None else 'None\n')
    f.writelines([', '.join(arr_pcr), '\n'] if arr_pcr is not None else 'None\n')
    f.writelines([', '.join(arr_psr), '\n'] if arr_psr is not None else 'None\n')
f.close()